---
import BaseLayout from "./BaseLayout.astro";
import Sidebar from "@/components/docs/Sidebar.astro";
import TableOfContents from "@/components/docs/TableOfContents.astro";
import { buildNavigation, getActiveTab } from "@/lib/navigation";
import { navigation } from "@data/config";
import type { HeadSEOProps } from "@/lib/types";

interface Props extends Partial<HeadSEOProps> {
    currentSlug: string;
    headings?: { depth: number; slug: string; text: string }[];
}

const { currentSlug, headings = [], ...headProps } = Astro.props;

// Build navigation
const navResult = await buildNavigation(navigation);
const activeTab = getActiveTab(currentSlug, navResult.tabs);

// Convert headings to TableOfContents format
const tableOfContentsHeadings = headings.map((h) => ({
    depth: h.depth,
    text: h.text,
    id: h.slug,
}));
---

<BaseLayout {...headProps}>
    <div class="min-h-screen flex">
        <!-- Sidebar with tabs inside  -->
        <Sidebar
            tabs={navResult.tabs}
            showTabs={navResult.showTabs}
            activeTab={activeTab}
            currentSlug={currentSlug}
        />

        <!-- Main content  -->
        <main class="flex-1 px-8 py-6">
            <article class="prose prose-slate dark:prose-invert">
                <slot />
            </article>
        </main>

        <!-- Table of Contents on the right  -->
        <TableOfContents headings={tableOfContentsHeadings} />
    </div>
</BaseLayout>
