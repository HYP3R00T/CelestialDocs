---
import { getCollection, render } from "astro:content";
import type { CollectionKey } from "astro:content";
import DocsLayout from "@/layouts/DocsLayout.astro";
import MdxImage from "@/components/docs/markdown/MdxImage.astro";
import MdxLink from "@/components/docs/markdown/MdxLink.astro";
import { CONTENT } from "@data/config";

export async function getStaticPaths() {
    const paths: {
        params: { collection: CollectionKey; slug: string };
        props: {
            doc: Awaited<ReturnType<typeof getCollection>>[number];
            collection: CollectionKey;
        };
    }[] = [];

    for (const sys of CONTENT.systems) {
        const entries = await getCollection(sys.id as CollectionKey);
        for (const doc of entries) {
            paths.push({
                params: { collection: sys.id as CollectionKey, slug: doc.id },
                props: { doc, collection: sys.id as CollectionKey },
            });
        }
    }

    return paths;
}

const { doc, collection } = Astro.props as {
    doc: Awaited<ReturnType<typeof getCollection>>[number];
    collection: CollectionKey;
};
const { Content, headings } = await render(doc);

const components = {
    img: MdxImage,
    a: MdxLink,
};
---

<DocsLayout frontmatter={doc} headings={headings} collection={collection}>
    <Content components={components} />
</DocsLayout>
