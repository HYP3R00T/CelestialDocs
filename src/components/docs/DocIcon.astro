---
import { Icon } from "astro-icon/components";
import { readdirSync } from "node:fs";
import { resolve } from "node:path";
import type { DocIconProps } from "@/lib/docs/types";

const { name, class: className, ...rest } = Astro.props as DocIconProps;

if (!name) {
    return null;
}

const emojiRegex = /\p{Emoji}/u;
const isEmoji = emojiRegex.test(name);

const emojiClass = [
    "inline-flex items-center justify-center leading-none",
    className,
]
    .filter(Boolean)
    .join(" ");

let iconName = "document";

if (!isEmoji) {
    const iconsPath = resolve("./src/assets/icons");
    let iconExists = false;

    try {
        const files = readdirSync(iconsPath);
        iconExists = files.includes(`${name}.svg`);
    } catch (error) {
        iconExists = false;
    }

    iconName = iconExists ? name : "document";
}
---

{
    isEmoji ? (
        <span class={emojiClass} {...rest}>
            {name}
        </span>
    ) : (
        <Icon name={iconName} class={className} {...rest} />
    )
}
