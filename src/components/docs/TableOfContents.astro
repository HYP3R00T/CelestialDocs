---
import { TABLE_OF_CONTENTS } from "@data/config";

import TableOfContentsExtra from "./TableOfContentsExtra.astro";

import type { TableOfContentsProps } from "@/lib/docs/types";

const { headings = [] } = Astro.props as TableOfContentsProps;
const extraEnabled = TABLE_OF_CONTENTS.enableExtra;
const tocMaxHeight = extraEnabled ? "calc((100vh - 5.25rem) * 0.66)" : "calc(100vh - 5.25rem)";

// Filter to only include h2 and h3 headings for the TOC
const filteredHeadings = headings.filter((h) => h.depth === 2 || h.depth === 3);
---

{
    filteredHeadings.length > 0 && (
        <aside class="sticky top-17 hidden h-[calc(100vh-5.25rem)] min-w-2xs xl:block">
            <div class="flex h-full flex-col gap-4">
                <section class="bg-popover rounded-lg p-5" style={`max-height: ${tocMaxHeight}`}>
                    <nav aria-label="Table of contents" class="flex h-full flex-col">
                        <h3 class="text-foreground mb-4 text-sm font-semibold">On this page</h3>
                        <ul class="flex-1 space-y-2 overflow-y-auto text-sm">
                            {filteredHeadings.map((heading) => (
                                <li class={heading.depth === 3 ? "ml-4" : ""}>
                                    <a
                                        href={`#${heading.id}`}
                                        class="text-muted-foreground hover:text-foreground transition-colors"
                                    >
                                        {heading.text}
                                    </a>
                                </li>
                            ))}
                        </ul>
                    </nav>
                </section>
                {extraEnabled && <TableOfContentsExtra />}
            </div>
        </aside>
    )
}

<style>
    aside {
        width: 280px;
    }

    @media (max-width: 1280px) {
        aside {
            display: none;
        }
    }
</style>
