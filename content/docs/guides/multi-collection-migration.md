---
title: "Multi-Collection Migration Guide"
description: "Upgrade your single-docs setup to support multiple documentation collections"
navLabel: "Multi-Collection Migration"
---

# Multi-Collection Migration Guide

CelestialDocs now supports multiple content systems (e.g., docs, notes, guides, tutorials). This guide helps you understand and migrate to the new architecture.

## What Changed?

### Before (Single Collection)
```typescript
// data/config.ts
export const CONTENT = {
    dir: "content/docs",
    defaultDocRedirect: "/docs/getting-started/introduction",
};
```

**Routes**: All content lived under `/docs`

### After (Multiple Collections)
```typescript
// data/config.ts
export const CONTENT = {
    systems: [
        {
            id: "docs",
            dir: "content/docs",
            defaultDocRedirect: "/docs/getting-started/introduction",
            route: "/docs",
        },
        {
            id: "notes",
            dir: "notes",
            defaultDocRedirect: "/notes/getting-started",
            route: "/notes",
        },
    ],
};
```

**Routes**: Content can be at `/docs`, `/notes`, `/guides`, or any custom route.

## Key Concepts

### Content System
A content system is a separate documentation collection with its own:
- Content directory (`dir`)
- Route prefix (`route`)
- Default redirect (`defaultDocRedirect`)
- Navigation structure (`SIDEBAR_NAVIGATION[systemId]`)

### Example: Adding a "Guides" Collection

1. **Register the system** in `data/config.ts`:

```typescript
export const CONTENT = {
    systems: [
        // ... existing systems
        {
            id: "guides",
            dir: "content/guides",
            defaultDocRedirect: "/guides/getting-started",
            route: "/guides",
        },
    ],
};
```

2. **Create content directory**:
```
content/guides/
├── index.md
├── getting-started.md
├── advanced/
│   └── patterns.md
└── faq.md
```

3. **Define navigation** in `data/config.ts`:

```typescript
export const SIDEBAR_NAVIGATION: SidebarNavigation = {
    docs: {
        // ... existing docs config
    },
    guides: {
        defaultTab: {
            label: "Guides",
            icon: "book",
        },
        groups: [
            {
                id: "getting-started",
                label: "Getting Started",
                icon: "rocket",
                autoGenerated: true,
            },
            // ... more groups
        ],
    },
};
```

4. **Add header navigation link** (optional):

```typescript
export const HEADER_NAV_ITEMS: NavItem[] = [
    { href: "/docs", label: "Docs", special: true },
    { href: "/notes", label: "Notes" },
    { href: "/guides", label: "Guides" },  // New!
];
```

5. **Update header collection config** in `[collection]/index.astro`:

```typescript
export async function getStaticPaths() {
    const paths: any[] = [];
    for (const sys of CONTENT.systems) {
        paths.push({
            params: { collection: sys.id },
            props: { collection: sys.id },
        });
    }
    return paths;
}
```

The routing is **automatic**! Astro will generate:
- `/guides`
- `/guides/getting-started`
- `/guides/advanced/patterns`
- `/guides/faq`

## Migration Steps for Existing Projects

### Step 1: Update Configuration

Replace your single `CONTENT` object with `CONTENT.systems`:

```typescript
// ❌ Old
export const CONTENT = {
    dir: "content/docs",
    defaultDocRedirect: "/docs/getting-started/introduction",
};

// ✅ New
export const CONTENT = {
    systems: [
        {
            id: "docs",
            dir: "content/docs",
            defaultDocRedirect: "/docs/getting-started/introduction",
            route: "/docs",
        },
    ],
};
```

### Step 2: Update SIDEBAR_NAVIGATION

Wrap your sidebar config in a mapping:

```typescript
// ❌ Old
export const SIDEBAR_NAVIGATION: Sidebar = {
    defaultTab: { label: "Docs", icon: "book" },
    groups: [ /* ... */ ],
};

// ✅ New
export const SIDEBAR_NAVIGATION: SidebarNavigation = {
    docs: {
        defaultTab: { label: "Docs", icon: "book" },
        groups: [ /* ... */ ],
    },
};
```

### Step 3: Update Content Collections

The new system automatically handles multiple collections:

```typescript
// ✅ Already done for you!
// src/content.config.ts
for (const sys of CONTENT.systems) {
    collectionsMap[sys.id] = defineCollection({
        loader: glob({ pattern: "**/*.{md,mdx}", base: `./${sys.dir}` }),
        schema: createSchema,
    });
}
```

### Step 4: Delete Old Page Routes (if present)

Remove single-collection routes:

```
❌ Delete: src/pages/docs/[...slug].astro
❌ Delete: src/pages/docs/[...slug].md.ts
❌ Delete: src/pages/docs/index.astro

✅ They're replaced by: src/pages/[collection]/[...slug].astro (etc.)
```

## Type Safety

The new system includes proper TypeScript types:

```typescript
import type { ContentSystem, ContentConfig } from "@/lib/types";
import type { SidebarNavigation } from "@/lib/docs/types";

// Configuration is now typed
export const CONTENT: ContentConfig = { /* ... */ };
export const SIDEBAR_NAVIGATION: SidebarNavigation = { /* ... */ };
```

## Using the System Resolver Utility

Avoid repeating system lookup code with the `resolveSystem` utility:

```typescript
import { resolveSystem, getSystemRoute } from "@/lib/resolveSystem";

// Resolve a system by ID (throws if not found)
const system = resolveSystem("docs");
const system = resolveSystem(collectionId);  // Defaults to "docs"

// Get the route for a system
const route = getSystemRoute("notes");  // Returns "/notes"
const route = getSystemRoute();         // Returns "/docs" (default)
```

## Component Updates

Components now accept `collectionId` to support multiple systems:

```astro
<Sidebar
    tabs={tabs}
    showTabs={showTabs}
    activeTab={activeTab}
    currentSlug={slug}
    collectionId={collectionId}  // New!
/>
```

This ensures breadcrumbs, links, and navigation work correctly for all systems.

## Backward Compatibility

⚠️ **This template no longer supports the old single-collection structure.** All backward compatibility has been removed.

**If upgrading from an older version**, you must:
1. Update `CONTENT` to use `systems` array
2. Update `SIDEBAR_NAVIGATION` to use system-keyed mapping
3. Ensure all custom components receive and use `collectionId`

## Common Questions

### Q: Can I have different navigation structures per system?

**A:** Yes! Each system has its own `SIDEBAR_NAVIGATION[systemId]` config.

### Q: Can I share content between systems?

**A:** Content is directory-based. For shared content, consider:
- Including markdown files in both directories
- Creating a shared components library
- Using the notes system for shared reference material

### Q: Do I need separate content directories?

**A:** Yes, the `dir` property points to the source directory for each system. This keeps collections separate and prevents conflicts.

### Q: Can I customize routes?

**A:** Yes! Set the `route` property in each system config:

```typescript
{
    id: "docs",
    dir: "content/docs",
    route: "/documentation",  // Custom route!
}
```

### Q: How do drafts work with multiple systems?

**A:** Use `draft: true` in frontmatter. Drafts are still accessible at their URLs but you can filter them in custom pages if needed.

## Next Steps

1. ✅ Review your current `data/config.ts`
2. ✅ Update to use `CONTENT.systems`
3. ✅ Update `SIDEBAR_NAVIGATION` to support systems
4. ✅ Test routing for all collections
5. ✅ Add header navigation links
6. ✅ (Optional) Create additional collections

---

For questions or issues, refer to the [Config Reference](../developer/config-reference) and [Content Collections](../developer/content-collections) guides.
