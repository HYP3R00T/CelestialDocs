---
title: "Navigation API"
description: "Developer reference for `src/lib/navigation/*`"
pubDatetime: 2025-12-21T00:00:00Z
navLabel: "Navigation API"
---

This page documents the internal navigation builder in `src/lib/navigation/*`. The library converts a collection of docs into a sidebar and tabs structure using a few small, testable functions. It's intended for contributors who want to modify navigation behavior, add tests, or extend the builder.

## Key concepts & types

- **DocEntry** — the raw object returned by `getDocsFromFilesystem` (id, slug, data with frontmatter fields like `title`, `navLabel`, `navIcon`, `navOrder`, `navHidden`).
- **ProcessedEntry** — a normalized entry used for rendering `{ slug, label, icon?, order? }`.
- **ProcessedGroup** — a normalized group with `entries`, `groups`, and optional `children` (used when preserving an explicit ordering that mixes entries and groups).
- **Tab** — top-level UI tab with `id`, `label`, `icon`, and `group` (a `ProcessedGroup`).
- **NavigationResult** — the final output `{ tabs, showTabs }` consumed by layouts.

Refer to `src/lib/navigation/types.ts` for exact TypeScript definitions.

---

## Functions (what they do)

### getDocsFromFilesystem()
- Location: `src/lib/navigation/loader.ts`
- Purpose: fetch all docs using `getCollection('docs')` and return an array of `DocEntry` objects.
- Returns: `Promise<DocEntry[]>`.

Usage:
```ts
const docs = await getDocsFromFilesystem();
```

Notes:
- This is the single source of truth for docs discovery — tests and other functions should use it rather than calling `getCollection` directly.

---

### buildFilesystemStructure(docs)
- Location: `src/lib/navigation/buildFilesystemStructure.ts`
- Purpose: create a Map that groups `DocEntry` objects by folder path. Root-level entries are stored under the empty string key `''`.
- Returns: `Map<string, DocEntry[]>` mapping folder paths to entries.

Example output keys: `''`, `'getting-started'`, `'guides/advanced'`, etc.

Why it matters:
- The structure makes it easy to find pages that belong to a given group path and to build root-level entries for the default area.

---

### processGroup(group, filesystemStructure, allDocs)
- Location: `src/lib/navigation/process.ts`
- Purpose: recursively process a `Group` config (from `data/config.ts`) and produce a `ProcessedGroup` with resolved entries and nested groups.

Key behaviors:
- Respects `autoGenerated` to append filesystem entries that are not explicitly configured.
- Skips entries when `entry.hidden` or `doc.data.navHidden` is true.
- Uses `navLabel`/`navIcon`/`navOrder` from frontmatter if `label`/`icon`/`order` are not provided on the config.
- Recurses into nested `groups`.

Edge cases:
- Logs a warning if a configured `entry.slug` is not found in the docs collection.

---

### buildNavigationItems(items, filesystemStructure, allDocs)
- Location: `src/lib/navigation/buildNavigationItems.ts`
- Purpose: iterate top-level `GroupOrEntry` items and convert them into `NavigationItem[]` (either `entry` items or processed `group` objects).
- This function applies global filters such as `hidden` flags and ensures top-level manual entries map to existing doc entries.

---

### buildDefaultChildren(items) & createDefaultTab(children)
- Location: `src/lib/navigation/defaultChildren.ts`
- Purpose: assemble the default area (children and root entries) and create a default tab (`_default`) when appropriate.
- `buildDefaultChildren` returns `{ children, slugs }`, where `slugs` is a Set used to avoid duplicates.
- `createDefaultTab` converts the `children` array into a Tab object representing the default tab.

---

### buildRootEntries(filesystemStructure, slugs)
- Location: `src/lib/navigation/rootEntries.ts`
- Purpose: collect root-level documents (those at path `''`) that are not hidden and not already included in `slugs`.
- Returns an array of `ProcessedEntry` objects, sorted by label.

---

### buildTabs(items)
- Location: `src/lib/navigation/buildTabs.ts`
- Purpose: collect groups that are marked as tabs (`group.tab`) and convert them into the final `Tab[]` structure.
- Uses helpers in `tabs.ts` to collect and strip nested tab groups so each tab has a flattened inner structure.

---

## How to use the API (example)

If you want to build the navigation for rendering in a layout or for testing, call `buildNavigation`:

```ts
import { buildNavigation } from '@/lib/navigation/buildNavigation';
import { SIDEBAR_NAVIGATION } from '@data/config';

const result = await buildNavigation(SIDEBAR_NAVIGATION);
// result: { tabs: Tab[], showTabs: boolean }
```

This function orchestrates the entire pipeline: it gets docs, builds the filesystem structure, transforms configured groups/entries, creates tabs and default area, and returns a `NavigationResult`.

## Extension points & tests

- To change how filesystem entries are selected for a group, update `processGroup` — it centralizes `autoGenerated` and `navHidden` logic.
- To change tab detection or flattening, modify `tabs.ts` (`collectTabGroups`, `stripTabGroups`).
- Add unit tests for `buildFilesystemStructure`, `processGroup`, and `buildDefaultChildren` to ensure edge cases are captured.

## Debugging tips

- Look for `console.warn` messages printed by `buildNavigationItems` or `processGroup` — these usually indicate bad slugs or missing docs.
- Use the debug route (`src/pages/debug/navigation.json.ts`) to inspect the computed navigation JSON in the browser during development.
- To reproduce issues locally, run `pnpm dev` and refresh a page that uses `DocsLayout`; the layout computes navigation on server render and will include any warnings in server logs.

---

If you'd like, I can add ready-to-run unit test examples (using Vitest or Jest) that assert the behavior of `processGroup` and `buildFilesystemStructure`. Which would you prefer I add next — tests or a live debug route enhancement?
